<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Usuario</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
            body {
                background-color: black;
                color:brown;                
            }
          
    
    </style>
    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

    <script>
    "use strict";
    const urlGetAvatar = "http://localhost/Confe2/ws/get_avatar.php?id_usr="; 
	//const urlGetAvatar = "https://elpatioviveros.com/test/confe_ws/get_avatar.php?id_usr="; 

        $(document).ready(function () {
		sessionStorage.clear();
		
            $("#btnIngresar").click(function (e) {
                $(this).text("Cargando...");
                $(this).prop("disabled", true); 
								
                loadApp($("#selUsusario").val() );
            });
            
        });
        
function  loadApp (idUsusario) {                      
            fetch( urlGetAvatar + idUsusario )
                .then(
                    function(response) {
                    if (response.status !== 200) {
                        console.log('Error:', response.status);
                        return;
                    }                    
                    response.json().then(function(data) {
                        console.log(data);
                        guardarDatosAvatar(data[0] ); 
                        //window.location.assign("./preload.html");
						const tmpUrl = "http://construtecdeleste.com/test/preload.html?sexo=M&apiJuegos=http://localhost:60874/api/Juego/&idUsuario=1026&tipoAvatar=3&tipoTraje=biblico";
						console.log (tmpUrl);
						window.location.assign(tmpUrl);
						
						
                    });
                    }
                )
                .catch(function(err) {
                    console.log('Fetch Error :-S', err);
                });

        }


function guardarDatosAvatar (obj) {
//Camibar con el nuevo serivicio
    sessionStorage.setItem("idUsuario", obj.id_usr );
    sessionStorage.setItem("sexo", obj.sexo );
    sessionStorage.setItem("tipoAvatar", obj.tipo_avatar );
    sessionStorage.setItem("tipoTraje", obj.tipo_traje );
	//alamcena la url del servidor para pruebas
	const apiJuegos = "http://localhost:60874/api/Juego/";	
	sessionStorage.setItem("apiJuegos", apiJuegos );
	
	
}
    
    
    </script>
    
</head>
<body>

<div class="container mt-5">

    <div class="row">
        <div class="col-4  offset-4" >
            <img  class="img-fluid"  src="./assets/img/logo.png" alt="logo" >
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-4 offset-4">
                <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <label class="input-group-text" for="selUsusario">Ususario</label>
                        </div>
                        <select class="custom-select" id="selUsusario">
                          <option selected disabled >Seleccione...</option>
                          <option value=1026>luis@correo.de</option>
                          <option value="oscar.wong@correo.de"> Oscar Wong </option>
						  <option value="jimena@correo.de">jimena@correo.de </option>
                          <option value="ana@correo.de">ana@correo.de</option>
						  
                        </select>
                      </div>
                      
        </div>
    </div>
    <div class="row">
        <div class="col-4 offset-4 text-center">
                <button type="button" class="btn btn-outline-info" id="btnIngresar" >Ingresar</button>
        </div>
    </div>




</div>

    
</body>
</html>